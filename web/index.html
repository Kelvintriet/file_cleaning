<!DOCTYPE html>
<html>
  <head>
    <title>System Cleaner</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1><i class="fas fa-broom"></i> System Cleaner</h1>
        <p>Organize your Downloads folder instantly.</p>

        <!-- Profile Selector -->
        <div
          style="
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
            align-items: center;
          "
        >
          <div style="position: relative; display: inline-block">
            <select
              id="profile-select"
              style="
                padding: 6px 12px;
                border-radius: 6px;
                border: 1px solid #d2d2d7;
                font-size: 14px;
                min-width: 150px;
              "
            >
              <!-- Profiles populated by JS -->
            </select>
          </div>
          <button
            id="manage-profiles-btn"
            class="btn-text"
            style="font-size: 14px"
          >
            <i class="fas fa-edit"></i>
          </button>
          <button
            id="community-btn"
            class="btn-text"
            style="font-size: 14px; color: #007aff"
          >
            <i class="fas fa-globe"></i> Community
          </button>
        </div>
      </div>

      <div class="stats-card">
        <div class="stat-item">
          <i class="fas fa-folder-open"></i>
          <div class="stat-info">
            <span class="label">Target</span>
            <div style="display: flex; align-items: center; gap: 8px">
              <span class="value" id="target-path">Loading...</span>
              <button id="change-folder-btn" class="btn-text">Change</button>
            </div>
          </div>
        </div>
        <div class="stat-item" id="rules-trigger" style="cursor: pointer">
          <i class="fas fa-list-ul"></i>
          <div class="stat-info">
            <span class="label">Organize</span>
            <span class="value">Rules</span>
          </div>
        </div>
        <div class="stat-item" id="ai-trigger" style="cursor: pointer">
          <i class="fas fa-brain"></i>
          <div class="stat-info">
            <span class="label">Smart Sort</span>
            <span class="value">AI Assistant</span>
          </div>
        </div>
        <div class="stat-item" id="settings-trigger" style="cursor: pointer">
          <i class="fas fa-cog"></i>
          <div class="stat-info">
            <span class="label">Settings</span>
            <span class="value">Ignore List</span>
          </div>
        </div>
      </div>

      <!-- AI Modal -->
      <div id="ai-modal" class="modal hidden">
        <div class="modal-content modal-content-large">
          <div class="modal-header">
            <h2><i class="fas fa-magic"></i> AI Smart Sort</h2>
            <button id="close-ai" class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <!-- Step 1: Config -->
            <div id="ai-step-config">
              <p>Use AI to analyze and sort your files intelligently.</p>

              <div class="form-group">
                <label>API Configuration</label>
                <div style="display: flex; gap: 10px; margin-bottom: 10px">
                  <input
                    type="text"
                    id="ai-base-url"
                    placeholder="Base URL (e.g. https://api.sambanova.ai/v1)"
                    value="https://api.sambanova.ai/v1"
                    style="flex: 2"
                  />
                  <input
                    type="text"
                    id="ai-model-name"
                    placeholder="Model Name"
                    value="Meta-Llama-3.1-8B-Instruct"
                    style="flex: 1"
                  />
                </div>
                <input
                  type="password"
                  id="ai-api-key"
                  placeholder="Enter your API Key"
                />
                <small
                  >Compatible with any OpenAI-like API (SambaNova, OpenAI, Groq,
                  LocalAI).</small
                >
              </div>

              <div class="form-group">
                <label>Analysis Mode</label>
                <select
                  id="ai-mode"
                  style="
                    width: 100%;
                    padding: 10px;
                    border-radius: 8px;
                    border: 1px solid #d2d2d7;
                  "
                >
                  <option value="name_only">File Name Only (Fast)</option>
                  <option value="content">
                    Name + Content Summary (Slower, More Accurate)
                  </option>
                </select>
                <small
                  >Content mode reads text files (&lt;10KB) and summarizes them
                  using Sumy before asking AI.</small
                >
              </div>

              <div class="form-group">
                <label>Custom Instructions</label>
                <textarea
                  id="ai-instructions"
                  rows="3"
                  placeholder="e.g. Put all finance files in 'Finance' regardless of extension. Ignore temporary files."
                ></textarea>
                <small>Describe your situation or specific needs.</small>
              </div>

              <div style="display: flex; gap: 20px; margin-top: 15px">
                <label
                  style="
                    display: flex;
                    gap: 8px;
                    align-items: center;
                    cursor: pointer;
                    font-size: 14px;
                  "
                >
                  <input type="checkbox" id="ai-prioritize-rules" checked />
                  Prioritize My Rules
                </label>
                <label
                  style="
                    display: flex;
                    gap: 8px;
                    align-items: center;
                    cursor: pointer;
                    font-size: 14px;
                  "
                >
                  <input type="checkbox" id="ai-respect-ignore" checked />
                  Respect Ignore List
                </label>
              </div>

              <button
                id="start-ai-scan-btn"
                class="btn-primary"
                style="width: 100%; margin-top: 20px"
              >
                Start AI Analysis
              </button>
            </div>

            <!-- Step 2: Scanning -->
            <div
              id="ai-step-scanning"
              class="hidden"
              style="text-align: center; padding: 40px"
            >
              <i
                class="fas fa-spinner fa-spin"
                style="font-size: 40px; color: #0071e3; margin-bottom: 20px"
              ></i>
              <h3>Analyzing Files...</h3>
              <p>Reading content, summarizing, and consulting AI.</p>
            </div>

            <!-- Step 3: Review -->
            <div id="ai-step-review" class="hidden">
              <h3>Review Suggestions</h3>
              <p>
                Please review the AI's suggestions carefully before applying.
              </p>

              <div
                class="table-container"
                style="
                  max-height: 300px;
                  overflow-y: auto;
                  border: 1px solid #eee;
                  border-radius: 8px;
                "
              >
                <table
                  style="
                    width: 100%;
                    border-collapse: collapse;
                    font-size: 14px;
                  "
                >
                  <thead>
                    <tr style="background: #f9f9f9; text-align: left">
                      <th style="padding: 10px">
                        <input type="checkbox" id="ai-select-all" checked />
                      </th>
                      <th style="padding: 10px">File</th>
                      <th style="padding: 10px">Suggested Folder</th>
                      <th style="padding: 10px">Reason</th>
                    </tr>
                  </thead>
                  <tbody id="ai-results-list">
                    <!-- Rows injected here -->
                  </tbody>
                </table>
              </div>

              <div
                style="
                  background: #fff3cd;
                  padding: 15px;
                  border-radius: 8px;
                  margin-top: 20px;
                  border: 1px solid #ffeeba;
                "
              >
                <label
                  style="
                    display: flex;
                    gap: 10px;
                    align-items: flex-start;
                    cursor: pointer;
                  "
                >
                  <input
                    type="checkbox"
                    id="ai-risk-ack"
                    style="margin-top: 4px"
                  />
                  <span style="font-size: 13px; color: #856404">
                    <strong>Warning:</strong> I acknowledge that AI suggestions
                    may not always be perfect. I have reviewed the changes above
                    and accept the risk of moving these files.
                  </span>
                </label>
              </div>

              <div class="modal-footer">
                <button id="ai-back-btn" class="btn-secondary">Back</button>
                <button id="apply-ai-btn" class="btn-primary" disabled>
                  Apply Selected Changes
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Rules Modal -->
      <div id="rules-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 600px">
          <div class="modal-header">
            <h2>Organization Rules</h2>
            <button id="close-rules" class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <div id="rules-list"></div>
            <button
              id="add-rule-btn"
              class="btn-secondary"
              style="width: 100%; margin-top: 10px"
            >
              <i class="fas fa-plus"></i> Add New Rule
            </button>
          </div>
        </div>
      </div>

      <!-- Edit Rule Modal (Nested or separate, let's make it separate) -->
      <div id="edit-rule-modal" class="modal hidden" style="z-index: 200">
        <div class="modal-content">
          <div class="modal-header">
            <h2 id="edit-rule-title">Edit Rule</h2>
            <button id="close-edit-rule" class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label>Rule Name</label>
              <input type="text" id="rule-name" placeholder="e.g. Images" />
            </div>
            <div class="form-group">
              <label>Extensions (comma separated)</label>
              <input
                type="text"
                id="rule-extensions"
                placeholder="jpg, png, gif"
              />
            </div>
            <div class="form-group">
              <label>Target Folder</label>
              <div style="display: flex; gap: 10px">
                <input
                  type="text"
                  id="rule-folder"
                  placeholder="Folder Name or Absolute Path"
                  style="flex: 1"
                />
                <button
                  id="browse-folder-btn"
                  class="btn-secondary"
                  style="padding: 0 15px; white-space: nowrap"
                >
                  <i class="fas fa-folder-open"></i> Browse
                </button>
              </div>
            </div>
            <div class="form-group">
              <label>Filename Pattern (Optional)</label>
              <input
                type="text"
                id="rule-pattern"
                placeholder="e.g. project-($)"
              />

              <div
                class="help-box"
                style="
                  background: #f0f7ff;
                  padding: 12px;
                  border-radius: 8px;
                  font-size: 12px;
                  margin-top: 10px;
                  color: #444;
                  border: 1px solid #cce5ff;
                "
              >
                <div
                  style="font-weight: 600; margin-bottom: 5px; color: #0071e3"
                >
                  <i class="fas fa-info-circle"></i> How to use Smart Sorting
                </div>
                Use <code>($)</code> in the pattern to capture text from the
                filename. This captured text will become a
                <strong>subfolder</strong> inside your target folder.
                <br /><br />
                <strong>Examples:</strong>
                <ul style="padding-left: 15px; margin: 5px 0 0 0">
                  <li>
                    <code>project-($)</code> matches
                    <code>project-<strong>alpha</strong>.pdf</code> <br />&rarr;
                    Moves to: <code>Target/alpha/</code>
                  </li>
                  <li style="margin-top: 4px">
                    <code>($)-invoice</code> matches
                    <code><strong>2024</strong>-invoice.png</code> <br />&rarr;
                    Moves to: <code>Target/2024/</code>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button id="save-rule-btn" class="btn-primary">Save Rule</button>
            <button
              id="delete-rule-btn"
              class="btn-secondary"
              style="background: #ff3b30; color: white"
            >
              Delete
            </button>
          </div>
        </div>
      </div>

      <!-- Profiles Management Modal -->
      <div id="profiles-modal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h2>Manage Profiles</h2>
            <button id="close-profiles" class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <div style="display: flex; gap: 10px; margin-bottom: 20px">
              <input
                type="text"
                id="new-profile-name"
                placeholder="New Profile Name"
                style="flex: 1"
              />
              <button id="create-profile-btn" class="btn-primary">
                Create
              </button>
            </div>

            <div id="profiles-list">
              <!-- List populated by JS -->
            </div>
          </div>
        </div>
      </div>

      <!-- Community Modal -->
      <div id="community-modal" class="modal hidden">
        <div class="modal-content modal-content-large">
          <div class="modal-header">
            <h2><i class="fas fa-users"></i> Community Rules</h2>
            <button id="close-community" class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <!-- URL input hidden for user, handled in backend -->
            <div
              style="
                margin-bottom: 20px;
                display: flex;
                justify-content: flex-end;
              "
            >
              <button id="refresh-community-btn" class="btn-primary">
                <i class="fas fa-sync"></i> Refresh List
              </button>
            </div>

            <div class="community-grid">
              <!-- List -->
              <div>
                <h3>Available Rules</h3>
                <div id="community-list" style="margin-top: 10px">
                  <div style="text-align: center; color: #888; padding: 20px">
                    Enter a URL and click Refresh to load rules.
                  </div>
                </div>
              </div>

              <!-- Actions -->
              <div
                style="
                  background: #fff;
                  border: 1px solid #eee;
                  padding: 15px;
                  border-radius: 8px;
                  height: fit-content;
                "
              >
                <h3>Share Your Rules</h3>
                <p style="font-size: 13px; color: #666; margin-bottom: 15px">
                  Upload your current active profile to the community.
                </p>
                <div class="form-group">
                  <label>Name</label>
                  <input
                    type="text"
                    id="publish-name"
                    placeholder="e.g. Developer Setup"
                  />
                </div>
                <div class="form-group">
                  <label>Description</label>
                  <textarea
                    id="publish-desc"
                    rows="3"
                    placeholder="What does this rule set do?"
                  ></textarea>
                </div>
                <div class="form-group">
                  <label>Author</label>
                  <input
                    type="text"
                    id="publish-author"
                    placeholder="Your Name"
                  />
                </div>
                <button
                  id="publish-btn"
                  class="btn-secondary"
                  style="width: 100%"
                >
                  <i class="fas fa-cloud-upload-alt"></i> Publish Profile
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Modal -->
      <div id="settings-modal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h2>File Filtering</h2>
            <button id="close-settings" class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <div
              style="
                margin-bottom: 20px;
                background: #f5f5f7;
                padding: 4px;
                border-radius: 8px;
                display: flex;
              "
            >
              <button
                id="filter-mode-exclude"
                class="mode-btn active"
                style="
                  flex: 1;
                  border: none;
                  background: #fff;
                  padding: 8px;
                  border-radius: 6px;
                  cursor: pointer;
                  font-weight: 500;
                  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                "
              >
                Exclude Mode
              </button>
              <button
                id="filter-mode-include"
                class="mode-btn"
                style="
                  flex: 1;
                  border: none;
                  background: transparent;
                  padding: 8px;
                  border-radius: 6px;
                  cursor: pointer;
                  font-weight: 500;
                  color: #666;
                "
              >
                Include Mode
              </button>
            </div>

            <p
              id="filter-desc"
              style="margin-bottom: 10px; font-size: 14px; color: #666"
            >
              Files matching these patterns will be
              <strong>IGNORED</strong> (skipped).
            </p>

            <textarea
              id="ignore-list-input"
              rows="8"
              placeholder="*.tmp&#10;*.crdownload&#10;~*&#10;desktop.ini"
            ></textarea>
            <div class="help-text">
              One pattern per line. Supports wildcards (*, ?).
            </div>
          </div>
          <div class="modal-footer">
            <button id="save-settings" class="btn-primary">
              Save Patterns
            </button>
          </div>
        </div>
      </div>

      <!-- History Modal -->
      <div id="history-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 500px">
          <div class="modal-header">
            <h2>Cleaning History</h2>
            <button id="close-history" class="close-btn">&times;</button>
          </div>
          <div class="modal-body" style="max-height: 400px; overflow-y: auto">
            <div id="history-list" class="history-list">
              <!-- History items injected here -->
            </div>
          </div>
        </div>
      </div>

      <div class="action-area">
        <div class="button-group">
          <button id="clean-btn" class="btn-primary">
            <i class="fas fa-magic"></i> Clean Now
          </button>
          <button id="history-btn" class="btn-secondary" title="View History">
            <i class="fas fa-history"></i> History
          </button>
        </div>

        <div id="progress-container" class="hidden">
          <div class="progress-bar">
            <div id="progress-fill"></div>
          </div>
          <span id="progress-text">0%</span>
        </div>
      </div>

      <div class="log-container">
        <h3>Activity Log</h3>
        <div id="log-list">
          <!-- Log items go here -->
          <div class="empty-state">Ready to clean.</div>
        </div>
      </div>
    </div>
    <script src="script.js"></script>
  </body>
</html>
